           *******************************************************
                            Listing of SPARK Text
                              Examiner GPL 2011
             Copyright (C) 2011 Altran Praxis Limited, Bath, U.K.
           *******************************************************


                        DATE : 31-MAY-2014 16:05:25.82

Line
   1  with Measures;
   2  with HRM;
   3  with ImpulseGenerator;
   4  
   5  package body ICD is
   6  
   7     NoShock : constant Measures.Joules := 0;
   8  
   9     procedure Off(Computer: in out ICDType) is
  10     begin
  11        Computer.IsOn := False;
  12     end Off;

+++        Flow analysis of subprogram Off performed: no 
           errors found.

  13  
  14     procedure On(Computer: in out ICDType) is
  15     begin
  16        Computer.IsOn := False;
  17     end On;

+++        Flow analysis of subprogram On performed: no 
           errors found.

  18  
  19     procedure Tick(Computer : in out ICDType; HeartRateMonitor : in HRM.HRMType) is
  20     begin
  21        if Computer.IsOn then
  22      -- read the heart rate from the HRM
  23         HRM.GetRate(HeartRateMonitor, Computer.Rate);
  24        else
  25      -- If the Computer is not on, return 0 for both values
  26         Computer.Rate := Measures.BPM'First;
  27        end if;
  28     end Tick;

+++        Flow analysis of subprogram Tick performed: no 
           errors found.

  29  
  30     procedure Detect_Fibrillation(Computer : in out ICDType) is
  31     begin
  32         Computer.isFib := True;
  33     end Detect_Fibrillation;

+++        Flow analysis of subprogram Detect_Fibrillation 
           performed: no errors found.

  34  
  35     procedure Detect_Tarchycardia(Computer : in out ICDType) is
  36     begin
  37         -- if the icd is on and the rate is above the upperbound
  38         -- and a Tarchycardia has not been detected
  39         if Computer.IsOn and Computer.Rate > Computer.UpperBound 
  40         and Computer.IsTar = False then
  41            -- something bad is about to happen!
  42            -- so start a treatment
  43            Computer.IsTar := True;
  44         end if;
  45     end Detect_Tarchycardia;

+++        Flow analysis of subprogram Detect_Tarchycardia 
           performed: no errors found.

  46  
  47     procedure Set_Next_Impulse(Computer : in out ICDType) is
  48     begin
  49        if Computer.IsTar and Computer.Count < MaxShocks then
  50           Computer.Next := Computer.Rate + Integer(Float'Floor (600.0 / (Float(Computer.UpperBound) + ProjectedRate)));
  51        end if;
  52     end Set_Next_Impulse;

+++        Flow analysis of subprogram Set_Next_Impulse 
           performed: no errors found.

  53  
  54     procedure Init(Computer : in out ICDType) is
  55     begin
  56          Computer.Rate := Measures.BPM'First;
  57     end Init;

+++        Flow analysis of subprogram Init performed: no 
           errors found.

  58  end ICD;


--End of file--------------------------------------------------
