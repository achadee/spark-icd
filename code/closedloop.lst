           *******************************************************
                            Listing of SPARK Text
                              Examiner GPL 2011
             Copyright (C) 2011 Altran Praxis Limited, Bath, U.K.
           *******************************************************


                        DATE : 31-MAY-2014 15:15:59.20

Line
   1  with Measures;
   2  with HRM;
   3  with ImpulseGenerator;
   4  with Heart;
   5  with Icd;
   6  
   7  -- This package defines a very simple and crude simulation of a heart.
   8  --  The default behaviour is for the heart to speed up, unless it
   9  --  receives a small shock, in which case it will slow down, or a
  10  --  large shock, in which case it will cease working
  11  package body ClosedLoop is
  12     -- Create objects init objects
  13     -- I create it in here to hide it from ClosedLoopExample
  14     -- TODO move to ads as record
  15     -- Initialise the system, setting a heart rate from a normal
  16     -- probability distribution.
  17  
  18     procedure Off(Sys: in out ClosedLoopType) is
  19     begin
  20        Icd.Off(Sys.Comp);
  21        HRM.Off(Sys.Monitor);
  22        ImpulseGenerator.Off(Sys.Shock);
  23     end Off;

+++        Flow analysis of subprogram Off performed: no 
           errors found.

  24  
  25     procedure On(Sys: in out ClosedLoopType) is
  26     begin
  27        Icd.On(Sys.Comp);
  28        HRM.On(Sys.Monitor,Sys.Hrt);
  29        ImpulseGenerator.On(Sys.Shock);
  30     end On;

+++        Flow analysis of subprogram On performed: no 
           errors found.

  31  
  32     procedure Init(Sys: in out ClosedLoopType) is
  33     begin
  34        HRM.Init(Sys.Monitor);
  35        ImpulseGenerator.Init(Sys.Shock);
  36        Icd.Init(Sys.Comp);
  37     end Init;

+++        Flow analysis of subprogram Init performed: no 
           errors found.

  38  
  39     -- Tick the system, providing an impulse to the heart.
  40     procedure Tick(Sys : in out ClosedLoopType) is
  41     begin
  42        for I in Integer range 0..100 loop
  43           -- if the computer is on, tick through the entire system
  44           if Sys.Comp.isOn then
  45              HRM.Tick(Sys.Monitor,Sys.Hrt);
  46              ICD.Tick(Sys.Comp, Sys.Monitor);
  47              ImpulseGenerator.Tick(Sys.Shock, Sys.Hrt);
  48           end if;
  49        end loop;
  50     end Tick;

+++        Flow analysis of subprogram Tick performed: no 
           errors found.

  51  
  52  end ClosedLoop;


--End of file--------------------------------------------------
